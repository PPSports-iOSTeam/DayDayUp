# DayDayUp  201906

## 1. delegate 和 datesource 有什么区别？ block 与 协议 适用场景以及性能上有何区别？
### delegate和datasource的区别

本质上来说两者是没有区别的。从设计上来区别delegate和datasource易于代码的维护。以tableview为例， delegate更偏重于用户交互的回调，datasource偏 重于数据的回调。两者在数据流向上也有区别，delegate为数据流向为tableview->delegate, datasource数据 流向为datasource->tableview。

### block和协议的使用场景

* 在离散型的调用场景下，每一次回调都是能够保证任务一致的，适用delegate。而在集约型调用的场景下，使用block是合理的，因为每次请求的类型都不-样，那么自然回调要做的任务也都会不一样，因此采用block。以网络请求为例，苹果的原生网络框架采用delegate的方式，是因为苹果基于离散型设计模型去设计网络调用的；而AFN属于集约型的调用。所谓集约型，就是只能业务层提供一一个方法，所有业务层的网络请求都要通过该方法完成。集约型的好处是对于网络层的编写来说方便快捷，对业务的适用性较强。离散型就是根据功能模块分为不同的模块，分别提供不同的方法给业务层调用。离散型便于理解，项目结构更清晰同时要求对业务具有较好的抽象能力。另外可以参考离散型和集约型的说明，复杂业务选用delegate, 单一业务选用block的方式。

* 像id <delegate> obj基于协议分发会广泛灵活些，block跟类型就强关联适合点对点调用。

### 性能的区别

delegate运行成本低，block成本很高。block出栈需要将使用的数据从栈内存拷贝到堆内存，当然对象的话就是加计数，使用完或者block置nil后才消除；delegate只是保存了-一个对象指针，直接回调，没有额外消耗。相对C的函数指针，只多做了一个查表动作。
